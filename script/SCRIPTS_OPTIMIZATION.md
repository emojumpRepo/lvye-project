# é¡¹ç›®è„šæœ¬å‘½ä»¤ä¼˜åŒ–è¯´æ˜

## ğŸ“¦ ä¼˜åŒ–å†…å®¹

### ä¼˜åŒ–å‰
```json
"release": "node script/release.mjs",
"release:deploy": "node script/release-with-deploy.mjs",
"test:dify": "node script/test-dify.mjs"
```

### ä¼˜åŒ–å
```json
"release": "node script/release.mjs",                    // äº¤äº’å¼å‘å¸ƒï¼ˆé€‰æ‹©å‰ç«¯/åç«¯ï¼‰
"release:deploy": "node script/release-with-deploy.mjs", // å‘å¸ƒ + è‡ªåŠ¨éƒ¨ç½²
"release:frontend": "node script/release.mjs frontend",   // âœ¨ æ–°å¢ï¼šç›´æ¥å‘å¸ƒå‰ç«¯
"release:backend": "node script/release.mjs backend",     // âœ¨ æ–°å¢ï¼šç›´æ¥å‘å¸ƒåç«¯
"dev:test-dify": "node script/test-dify.mjs"             // âœ¨ ä¼˜åŒ–ï¼šæ ‡è®°ä¸ºå¼€å‘å·¥å…·
```

---

## ğŸ¯ å‘½ä»¤è¯´æ˜

### 1. å‘å¸ƒç›¸å…³

#### `npm run release`
**äº¤äº’å¼ç‰ˆæœ¬å‘å¸ƒ**
- ğŸ¤– ä½¿ç”¨ AIï¼ˆDifyï¼‰ç”Ÿæˆå‘å¸ƒæ—¥å¿—
- ğŸ“¢ è‡ªåŠ¨å‘é€é£ä¹¦é€šçŸ¥
- ğŸ”– åˆ›å»º Git Tag
- ğŸ“ æ”¯æŒå‰åç«¯ç‹¬ç«‹ç‰ˆæœ¬ç®¡ç†

```bash
npm run release

# æµç¨‹ï¼š
# 1. é€‰æ‹©å‘å¸ƒç±»å‹ï¼ˆfrontend/backendï¼‰
# 2. é€‰æ‹©ç‰ˆæœ¬å‡çº§æ–¹å¼ï¼ˆmajor/minor/patchï¼‰
# 3. AI è‡ªåŠ¨ç”Ÿæˆå‘å¸ƒæ—¥å¿—
# 4. ç¡®è®¤å¹¶åˆ›å»º Tag
# 5. å‘é€é£ä¹¦é€šçŸ¥
```

#### `npm run release:frontend` âœ¨ æ–°å¢
**ç›´æ¥å‘å¸ƒå‰ç«¯ç‰ˆæœ¬**
```bash
npm run release:frontend

# è·³è¿‡é¡¹ç›®é€‰æ‹©ï¼Œç›´æ¥å‘å¸ƒå‰ç«¯
# é€‚åˆï¼šå‰ç«¯ç‹¬ç«‹è¿­ä»£å‘å¸ƒ
```

#### `npm run release:backend` âœ¨ æ–°å¢
**ç›´æ¥å‘å¸ƒåç«¯ç‰ˆæœ¬**
```bash
npm run release:backend

# è·³è¿‡é¡¹ç›®é€‰æ‹©ï¼Œç›´æ¥å‘å¸ƒåç«¯
# é€‚åˆï¼šåç«¯ç‹¬ç«‹è¿­ä»£å‘å¸ƒ
```

#### `npm run release:deploy`
**å‘å¸ƒ + è‡ªåŠ¨éƒ¨ç½²**
```bash
npm run release:deploy

# å®Œæ•´æµç¨‹ï¼š
# 1. æ‰§è¡Œç‰ˆæœ¬å‘å¸ƒï¼ˆåŒ releaseï¼‰
# 2. è‡ªåŠ¨æ„å»ºé¡¹ç›®
# 3. è‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨
```

---

### 2. å¼€å‘å·¥å…·

#### `npm run dev:test-dify` âœ¨ ä¼˜åŒ–
**æµ‹è¯• Dify Workflow API**

**ç”¨é€”**ï¼š
- âœ… æµ‹è¯• Dify API è¿æ¥
- âœ… è°ƒè¯• AI å‘å¸ƒæ—¥å¿—ç”Ÿæˆ
- âœ… éªŒè¯ Workflow é…ç½®
- âœ… æŸ¥çœ‹ API å“åº”ç»“æ„

```bash
npm run dev:test-dify

# æµ‹è¯•å†…å®¹ï¼š
# 1. æµ‹è¯•åŸºç¡€ API è¿æ¥
# 2. æµ‹è¯•ä¸åŒè¾“å…¥å­—æ®µï¼ˆquery/textï¼‰
# 3. æµ‹è¯•å®Œæ•´å‘å¸ƒæ—¥å¿—ç”Ÿæˆ
# 4. æ˜¾ç¤ºè¯¦ç»†å“åº”æ•°æ®
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
========================================
      Dify Workflow API æµ‹è¯•å·¥å…·
========================================

è·å–æœ€è¿‘10æ¡ Git æäº¤ï¼š
  1. feat(deploy): æ·»åŠ å¥åº·æ£€æŸ¥åŠŸèƒ½
  2. feat(deploy): å®ç°ä¸€é”®å›æ»š
  3. fix(deploy): ä¿®å¤ chown é—®é¢˜
  ...

æµ‹è¯• 1: ä½¿ç”¨ query ä½œä¸ºè¾“å…¥å­—æ®µ
âœ“ è¯·æ±‚æˆåŠŸ
æå–çš„è¾“å‡º: æœ¬æ¬¡ç‰ˆæœ¬æ›´æ–°ä¸»è¦åŒ…æ‹¬...

æµ‹è¯• 3: æç®€å‘å¸ƒæ—¥å¿—ç”Ÿæˆ
âœ“ å‘å¸ƒæ—¥å¿—ç”ŸæˆæˆåŠŸ
è€—æ—¶: 2.3 ç§’

ç”Ÿæˆçš„å‘å¸ƒæ—¥å¿—ï¼š
========================================
ã€ç‰ˆæœ¬ 1.0.0 æ›´æ–°æ—¥å¿—ã€‘
...
========================================
```

---

## ğŸ“Š å®Œæ•´å‘½ä»¤åˆ—è¡¨

### æ„å»ºå‘½ä»¤
```bash
npm run build:backend       # æ„å»ºåç«¯ï¼ˆMavenï¼‰
npm run build:frontend      # æ„å»ºå‰ç«¯ï¼ˆpnpmï¼‰
npm run build:all          # æ„å»ºå…¨éƒ¨
```

### éƒ¨ç½²å‘½ä»¤
```bash
npm run deploy:frontend     # éƒ¨ç½²å‰ç«¯ï¼ˆå«å¥åº·æ£€æŸ¥+CDNåˆ·æ–°ï¼‰
npm run deploy:backend      # éƒ¨ç½²åç«¯
npm run deploy:all         # éƒ¨ç½²å…¨éƒ¨
npm run rollback:frontend  # ä¸€é”®å›æ»šå‰ç«¯
```

### å‘å¸ƒå‘½ä»¤
```bash
npm run release            # äº¤äº’å¼å‘å¸ƒï¼ˆé€‰æ‹©é¡¹ç›®ï¼‰
npm run release:frontend   # ç›´æ¥å‘å¸ƒå‰ç«¯ âœ¨
npm run release:backend    # ç›´æ¥å‘å¸ƒåç«¯ âœ¨
npm run release:deploy     # å‘å¸ƒ+éƒ¨ç½²
```

### å¼€å‘å·¥å…·
```bash
npm run dev:test-dify      # æµ‹è¯• Dify API âœ¨
```

### é…ç½®å·¥å…·
```bash
npm run setup:cos          # å®‰è£… COSCLI
npm run config:cos         # é…ç½® COS è®¤è¯
```

---

## ğŸ“ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šå‰ç«¯å¿«é€Ÿè¿­ä»£
```bash
# 1. ä¿®æ”¹å‰ç«¯ä»£ç 
# 2. æ„å»º
cd mindtrip-ui/lvye-project-frontend/apps/web
pnpm build:antd

# 3. å‘å¸ƒç‰ˆæœ¬ï¼ˆç”Ÿæˆæ—¥å¿—+é€šçŸ¥ï¼‰
cd ../../..
npm run release:frontend

# 4. éƒ¨ç½²
npm run deploy:frontend
```

### åœºæ™¯ 2ï¼šåç«¯ç‹¬ç«‹å‘å¸ƒ
```bash
# 1. ä¿®æ”¹åç«¯ä»£ç 
# 2. å‘å¸ƒç‰ˆæœ¬
npm run release:backend

# 3. æ„å»º+éƒ¨ç½²
npm run build:backend
npm run deploy:backend
```

### åœºæ™¯ 3ï¼šè°ƒè¯• AI åŠŸèƒ½
```bash
# æµ‹è¯• Dify API æ˜¯å¦æ­£å¸¸
npm run dev:test-dify

# æŸ¥çœ‹ï¼š
# - API è¿æ¥çŠ¶æ€
# - è¾“å…¥è¾“å‡ºå­—æ®µå
# - ç”Ÿæˆçš„æ—¥å¿—è´¨é‡
```

### åœºæ™¯ 4ï¼šç´§æ€¥å›æ»š
```bash
# 1. å‘ç°çº¿ä¸Šé—®é¢˜
npm run rollback:frontend

# 2. é€‰æ‹©å†å²ç‰ˆæœ¬
# 3. é‡æ–°éƒ¨ç½²
npm run deploy:frontend
```

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### è„šæœ¬æ–‡ä»¶ä½ç½®

æ‰€æœ‰ release ç›¸å…³è„šæœ¬å·²ç»Ÿä¸€ç§»è‡³ `script/windows/` ç›®å½•ï¼š
- `script/windows/release.mjs` - ç‰ˆæœ¬å‘å¸ƒè„šæœ¬
- `script/windows/release-with-deploy.mjs` - å‘å¸ƒ+éƒ¨ç½²è„šæœ¬
- `script/windows/deploy-frontend.mjs` - å‰ç«¯éƒ¨ç½²
- `script/windows/deploy-backend.mjs` - åç«¯éƒ¨ç½²
- `script/windows/rollback-frontend.mjs` - å‰ç«¯å›æ»š

### `release:frontend` å’Œ `release:backend` å®ç°

è¿™ä¸¤ä¸ªå‘½ä»¤é€šè¿‡ç»™ `release.mjs` ä¼ é€’å‚æ•°å®ç°ï¼š
```bash
node script/windows/release.mjs frontend  # ç›´æ¥å‘å¸ƒå‰ç«¯
node script/windows/release.mjs backend   # ç›´æ¥å‘å¸ƒåç«¯
```

è„šæœ¬ä¼šæ£€æµ‹å‚æ•°ï¼Œè·³è¿‡é¡¹ç›®é€‰æ‹©æ­¥éª¤ã€‚

### `dev:test-dify` å‘½åè§„èŒƒ

ä½¿ç”¨ `dev:` å‰ç¼€è¡¨æ˜è¿™æ˜¯å¼€å‘å·¥å…·ï¼Œä¸ä¼šåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼š
- âœ… æ¸…æ™°åŒºåˆ†å¼€å‘å’Œç”Ÿäº§å‘½ä»¤
- âœ… IDE è‡ªåŠ¨è¡¥å…¨æ—¶æ›´æ˜“è¯†åˆ«
- âœ… ç¬¦åˆ npm scripts å‘½åè§„èŒƒ

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å‘å¸ƒå‘½ä»¤
1. **æ‰§è¡Œå‰ç¡®ä¿**ï¼š
   - âœ… ä»£ç å·²æäº¤åˆ° Git
   - âœ… åœ¨æ­£ç¡®çš„åˆ†æ”¯ä¸Š
   - âœ… `.env` é…ç½®æ­£ç¡®ï¼ˆDify APIï¼‰

2. **ç‰ˆæœ¬å·è§„åˆ™**ï¼š
   - `major` - é‡å¤§æ›´æ–°ï¼ˆ1.0.0 â†’ 2.0.0ï¼‰
   - `minor` - åŠŸèƒ½æ›´æ–°ï¼ˆ1.0.0 â†’ 1.1.0ï¼‰
   - `patch` - è¡¥ä¸ä¿®å¤ï¼ˆ1.0.0 â†’ 1.0.1ï¼‰

### Dify æµ‹è¯•å·¥å…·
1. **éœ€è¦é…ç½®**ï¼š
   - `script/test-dify.mjs` ä¸­çš„ API Key
   - Dify Workflow å¿…é¡»å·²å‘å¸ƒ

2. **ä¸»è¦ç”¨é€”**ï¼š
   - å¼€å‘é˜¶æ®µè°ƒè¯• Workflow
   - éªŒè¯è¾“å…¥è¾“å‡ºå­—æ®µ
   - ä¸éœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒè¿è¡Œ

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ç‰ˆæœ¬å‘å¸ƒæµç¨‹
```bash
# å®Œæ•´æµç¨‹
git add .
git commit -m "feat: æ–°åŠŸèƒ½"
npm run release:frontend      # å‘å¸ƒç‰ˆæœ¬
npm run deploy:frontend       # éƒ¨ç½²
```

### 2. å‰ç«¯å¿«é€Ÿå‘å¸ƒ
```bash
# è·³è¿‡éƒ¨ç½²ç¡®è®¤
npm run release:frontend      # åˆ›å»ºç‰ˆæœ¬
npm run deploy:frontend       # ä¸€é”®éƒ¨ç½²
```

### 3. è°ƒè¯• AI åŠŸèƒ½
```bash
# å¼€å‘æ—¶æµ‹è¯•
npm run dev:test-dify

# æŸ¥çœ‹ç”Ÿæˆæ•ˆæœï¼Œè°ƒæ•´ Workflow
# é‡å¤æµ‹è¯•ç›´åˆ°æ»¡æ„
```

---

## ğŸ‰ ä¼˜åŒ–æ€»ç»“

### æ–°å¢åŠŸèƒ½
1. âœ¨ `release:frontend` - å‰ç«¯å¿«é€Ÿå‘å¸ƒ
2. âœ¨ `release:backend` - åç«¯å¿«é€Ÿå‘å¸ƒ
3. âœ¨ `dev:test-dify` - æ¸…æ™°æ ‡è®°å¼€å‘å·¥å…·

### ä¼˜åŠ¿
- ğŸš€ **æ›´å¿«é€Ÿ** - ç›´æ¥å‘å¸ƒæ— éœ€é€‰æ‹©
- ğŸ¯ **æ›´ä¸“ä¸š** - å‘½åè§„èŒƒæ¸…æ™°
- ğŸ”§ **æ›´çµæ´»** - æ”¯æŒå‰åç«¯ç‹¬ç«‹è¿­ä»£
- ğŸ“ **æ›´æ˜“ç”¨** - å‘½ä»¤è¯­ä¹‰æ˜ç¡®

### ä¿æŒçš„åŠŸèƒ½
- âœ… åŸæœ‰çš„ `release` äº¤äº’å¼å‘å¸ƒ
- âœ… åŸæœ‰çš„ `release:deploy` è‡ªåŠ¨éƒ¨ç½²
- âœ… Dify æµ‹è¯•å·¥å…·ï¼ˆé‡å‘½åä¸º `dev:test-dify`ï¼‰

---

## ğŸ“ å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆä¿ç•™ `dev:test-dify`ï¼Ÿ**
A: è¿™æ˜¯å¾ˆæœ‰ç”¨çš„å¼€å‘è°ƒè¯•å·¥å…·ï¼Œå¯ä»¥ï¼š
- éªŒè¯ Dify API é…ç½®
- è°ƒè¯• Workflow è¾“å…¥è¾“å‡º
- æµ‹è¯• AI ç”Ÿæˆè´¨é‡

**Q: `release` å’Œ `release:frontend` æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**
A:
- `release` - äº¤äº’å¼ï¼Œéœ€è¦é€‰æ‹©é¡¹ç›®
- `release:frontend` - ç›´æ¥å‘å¸ƒå‰ç«¯ï¼Œæ›´å¿«é€Ÿ

**Q: ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ `release:deploy`ï¼Ÿ**
A: éœ€è¦ä¸€æ¬¡æ€§å®Œæˆ"å‘å¸ƒç‰ˆæœ¬+éƒ¨ç½²"æ—¶ä½¿ç”¨ï¼Œé€‚åˆå‘å¸ƒåç«‹å³ä¸Šçº¿çš„åœºæ™¯ã€‚
