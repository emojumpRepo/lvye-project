# 心理测评管理模块 (mindtrip-module-psychology)

## 模块概述

心理测评管理模块是对现有芋道教育管理系统的功能扩展，提供完整的学生心理健康评估和管理解决方案。

## 功能特性

- **学生档案管理**：建立和维护完整的学生心理健康档案，支持批量导入导出和年级毕业功能
- **心理测评**：支持多套固定问卷的测评任务创建和管理，包含任务ID/编号系统
- **测评结果分析**：提供详细的测评结果分析和报告生成，支持进度跟踪
- **危机干预**：自动风险检测和危机干预事件管理
- **通知系统**：多渠道通知推送和提醒机制
- **权限管理**：细化的角色权限体系，支持组织架构管理
- **综合时间线**：不可删除的学生档案时间线，记录所有关键业务事件
- **快速上报**：任课老师专用的快速上报功能

## 核心需求变更（基于最新会议讨论）

### 1. 登录与权限
- **统一默认密码**：所有用户设置统一的默认密码（如：123456）
- **强制修改密码**：用户首次使用默认密码登录时，强制要求修改密码

### 2. 测评管理（核心功能）
- **创建流程**：创建任务 → 选择学生 → 确认信息 → 发布
- **任务ID**：每个测评任务生成唯一的任务ID/任务编号
- **固定问卷**：第一期问卷为写死（Hardcode），不支持后台编辑
- **单一问卷**：一次测评任务只能选择一个问卷
- **双套问卷**：第一期上线两套问卷
- **进度跟踪**：显示"已完成"、"未完成"、"进行中"状态和进度

### 3. 学生管理
- **家长信息绑定**：家长信息与学生信息绑定，作为学生档案的一部分
- **批量操作**：支持学生的批量导入和导出功能
- **年级毕业功能**：可按年级进行全体毕业操作（优先级较低）
- **学生筛选**：支持"已毕业"/"未毕业"学生的筛选功能

### 4. 权限与角色管理（P0 - 核心高优功能）
- **组织架构**：支持树状组织架构：学校 → 学部 → 年级 → 班级
- **班级即部门**：将学校的"班级"映射为系统中的"部门"概念
- **角色权限划分**：
  - **系统管理员**：拥有最高权限，可查看所有数据
  - **年级管理员**：可查看其所管辖年级的全部师生数据
  - **班主任**：可查看自己所带班级的完整学生数据
  - **心理老师**：权限与其被分配管理的班级挂钩，是系统的主要使用者
  - **任课老师**：默认几乎无数据查看权限，主要功能是使用"快速上报"

### 5. 学生档案与日志
- **综合时间线**：在学生详情页建立综合时间线，记录所有关键业务事件
- **不可删除**：时间线日志不可删除，永久保存

## 模块结构

```
mindtrip-module-psychology/
├── src/main/java/com.lvye.mindtrip/module/psychology/
│   ├── api/                    # 对外API接口
│   │   ├── assessment/         # 测评相关API
│   │   ├── profile/           # 档案相关API
│   │   └── consultation/      # 咨询相关API
│   ├── controller/            # 控制器层
│   │   ├── admin/             # 管理端控制器（AdminUser访问）
│   │   │   ├── assessment/    # 测评管理控制器
│   │   │   ├── profile/       # 档案管理控制器
│   │   │   ├── organization/  # 组织架构控制器
│   │   │   ├── timeline/      # 时间线控制器
│   │   │   └── quickreport/   # 快速上报控制器
│   │   └── app/               # 学生家长端控制器（MemberUser访问）
│   ├── service/               # 业务逻辑层
│   │   ├── assessment/        # 测评服务
│   │   ├── profile/           # 档案服务
│   │   ├── consultation/      # 咨询服务
│   │   ├── notification/      # 通知服务
│   │   ├── organization/      # 组织架构服务
│   │   ├── timeline/          # 时间线服务
│   │   └── quickreport/       # 快速上报服务
│   ├── dal/                   # 数据访问层
│   │   ├── dataobject/        # 数据对象
│   │   │   ├── assessment/    # 测评相关DO
│   │   │   ├── profile/       # 档案相关DO
│   │   │   ├── timeline/      # 时间线相关DO
│   │   │   └── quickreport/   # 快速上报相关DO
│   │   ├── mysql/             # MySQL映射器
│   │   │   ├── assessment/    # 测评相关Mapper
│   │   │   ├── profile/       # 档案相关Mapper
│   │   │   ├── timeline/      # 时间线相关Mapper
│   │   │   └── quickreport/   # 快速上报相关Mapper
│   │   └── redis/             # Redis访问层
│   ├── convert/               # 对象转换器
│   │   ├── assessment/        # 测评相关转换器
│   │   ├── profile/           # 档案相关转换器
│   │   └── timeline/          # 时间线相关转换器
│   ├── enums/                 # 枚举类
│   │   ├── ErrorCodeConstants.java      # 错误码常量
│   │   ├── DictTypeConstants.java       # 字典类型常量
│   │   ├── UserRoleEnum.java           # 用户角色枚举
│   │   ├── AssessmentTaskStatusEnum.java # 测评任务状态枚举
│   │   ├── ParticipantCompletionStatusEnum.java # 参与者完成状态枚举
│   │   └── TimelineEventTypeEnum.java   # 时间线事件类型枚举
│   └── framework/             # 框架配置
└── src/main/resources/
    └── mapper/                # MyBatis映射文件
```

## 依赖关系

- 依赖 `mindtrip-module-system` 模块，复用用户、部门、权限等基础功能
- 依赖 `mindtrip-module-infra` 模块，复用文件、短信等基础功能
- 集成现有的用户认证和权限管理体系

## 数据库设计

- 表名前缀：`psychology_`
- 支持多租户架构
- 与现有系统的用户和部门体系集成
- 班级作为部门的子类型进行管理

## API设计

- 管理端API：`/admin-api/psychology/**`
- 学生家长端API：`/app-api/psychology/**`
- 支持多端访问和多角色协作

## 开发规范

1. 所有代码遵循现有项目的编码规范
2. 数据库操作考虑事务一致性
3. 外部接口调用添加异常处理
4. 敏感数据处理遵循数据安全规范
5. 完善的单元测试覆盖
6. 第一期问卷内容固定，不支持后台编辑
7. 时间线日志不可删除，确保数据完整性

## 部署说明

模块已集成到主项目的构建流程中，随主项目一起编译和部署。

## 开发进度

- [x] 模块基础结构创建
- [ ] 数据库表结构设计
- [ ] 核心业务逻辑实现
- [ ] API接口开发
- [ ] 前端页面开发
- [ ] 测试与部署