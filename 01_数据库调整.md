### 数据库表结构设计 (MySQL 语法)

#### 一、 心理咨询模块

这个模块的核心是 **“咨询预约”** 和 **“咨询评估”**。

**1. `counseling_appointments` - 咨询预约表**

这张表记录了每一次咨询的预约信息、状态和基本详情。

```sql
CREATE TABLE `counseling_appointments` (
  `id` INT AUTO_INCREMENT PRIMARY KEY,
  `student_id` INT NOT NULL COMMENT '学生ID (关联 students 表)',
  `counselor_id` INT NOT NULL COMMENT '主责咨询师ID (关联 users 表)',
  `appointment_time` DATETIME NOT NULL COMMENT '预约咨询的开始时间',
  `duration_minutes` INT DEFAULT 60 COMMENT '咨询时长（分钟）',
  `counseling_type` VARCHAR(100) NOT NULL COMMENT '咨询类型 (支持自定义)',
  `location` VARCHAR(255) COMMENT '咨询地点',
  `notes` TEXT COMMENT '预约时的备注信息',
  `status` ENUM('scheduled', 'completed', 'closed', 'canceled') NOT NULL DEFAULT 'scheduled' COMMENT '状态: 已预约, 已完成(待评估), 已闭环, 已取消',
  `cancellation_reason` TEXT COMMENT '取消原因 (当 status 为 canceled 时填写)',
  `is_overdue` BOOLEAN DEFAULT FALSE COMMENT '是否逾期 (由后台任务根据 appointment_time 和 status 定期更新)',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX `idx_student_id` (`student_id`),
  INDEX `idx_counselor_id` (`counselor_id`),
  INDEX `idx_appointment_time` (`appointment_time`)
) COMMENT '心理咨询预约记录表';
```

**2. `counseling_assessments` - 咨询评估表**

与预约表一对一关联，存放咨询完成后的详细评估报告内容。

```sql
CREATE TABLE `counseling_assessments` (
  `id` INT AUTO_INCREMENT PRIMARY KEY,
  `appointment_id` INT NOT NULL UNIQUE COMMENT '咨询预约ID (关联 counseling_appointments 表)',
  `student_id` INT NOT NULL COMMENT '学生ID (冗余字段，便于查询)',
  `counselor_id` INT NOT NULL COMMENT '评估人ID (关联 users 表)',
  `risk_level` ENUM('major', 'severe', 'general', 'observation') NOT NULL COMMENT '风险等级评估',
  `problem_types` JSON COMMENT '问题类型识别 (存储标签数组, e.g., ["学业压力", "人际关系"])',
  `follow_up_suggestion` VARCHAR(100) NOT NULL COMMENT '后续处理建议',
  `assessment_mode` ENUM('text', 'file') NOT NULL COMMENT '评估方式: 自由输入, 模板上传',
  `content` MEDIUMTEXT COMMENT '评估内容 (当 mode 为 text 时)',
  `file_id` INT COMMENT '上传的评估文件ID (当 mode 为 file 时, 关联系统已有的文件表)',
  `is_draft` BOOLEAN DEFAULT TRUE COMMENT '是否为草稿',
  `submitted_at` DATETIME COMMENT '评估报告最终提交时间',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX `idx_student_id` (`student_id`),
  INDEX `idx_counselor_id` (`counselor_id`)
) COMMENT '心理咨询评估报告表';
```

---

#### 二、 危机干预模块

此模块围绕 **“危机事件”** 的上报、处理和归档进行设计。

**1. `crisis_events` - 危机事件表**

记录危机事件的核心信息。

```sql
CREATE TABLE `crisis_events` (
  `id` INT AUTO_INCREMENT PRIMARY KEY,
  `student_id` INT NOT NULL COMMENT '涉及学生ID (关联 students 表)',
  `reporter_id` INT NOT NULL COMMENT '上报人ID (关联 users 表)',
  `assigned_counselor_id` INT COMMENT '指派的负责人ID (关联 users 表)',
  `event_time` DATETIME NOT NULL COMMENT '事件发生时间',
  `event_level` ENUM('major', 'severe', 'general') NOT NULL COMMENT '事件等级',
  `location` VARCHAR(255) COMMENT '事发地点',
  `description` TEXT NOT NULL COMMENT '事件情况描述',
  `status` ENUM('reported', 'assigned', 'processing', 'closed') NOT NULL DEFAULT 'reported' COMMENT '事件状态: 已上报, 已分配, 处理中, 已结案',
  `closure_summary` TEXT COMMENT '结案总结',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX `idx_student_id` (`student_id`),
  INDEX `idx_assigned_counselor_id` (`assigned_counselor_id`)
) COMMENT '危机干预事件记录表';
```

**2. `crisis_event_processes` - 危机事件处理过程表**

一对多关联危机事件表，记录对一个事件的每一次跟进和处理动作。

```sql
CREATE TABLE `crisis_event_processes` (
  `id` INT AUTO_INCREMENT PRIMARY KEY,
  `event_id` INT NOT NULL COMMENT '危机事件ID (关联 crisis_events 表)',
  `operator_id` INT NOT NULL COMMENT '操作人ID (关联 users 表)',
  `action` VARCHAR(100) NOT NULL COMMENT '操作类型 (如: 分配, 添加处理记录, 结案)',
  `content` TEXT NOT NULL COMMENT '处理内容记录',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX `idx_event_id` (`event_id`)
) COMMENT '危机事件处理过程流水表';
```