# 心理测评管理系统实施计划

## 项目概述

本实施计划将心理测评管理系统的开发分为多个阶段，每个任务都是独立的编码活动，可以增量式开发和测试。所有任务都基于已确认的需求文档和设计文档。

## 实施任务列表

### 阶段一：基础架构和数据模型





- [x] 1. 创建心理测评模块基础结构
  - 创建 `yudao-module-psychology` 模块的完整目录结构
  - 配置模块的 pom.xml 依赖关系
  - 创建基础的包结构：api、controller、service、dal等
  - 集成到主项目构建系统
  - _需求: 11.1, 11.2, 11.3, 11.4_

- [ ] 2. 创建数据库表结构和实体类
  - 创建所有心理测评相关的数据库表（10个核心表，包括时间线和快速上报表）
  - 编写对应的 DO（Data Object）实体类
  - 配置 MyBatis 映射关系
  - 扩展现有system_dept表以支持班级管理
  - _需求: 4.1, 4.3, 5.1, 8.1, 9.1, 10.1_

- [ ] 3. 实现基础枚举类和常量定义
  - 创建用户角色枚举（系统管理员、年级管理员、班主任、心理老师、任课老师）
  - 创建测评任务状态、参与者完成状态、时间线事件类型等枚举类
  - 定义错误码常量和业务常量（包括权限相关、组织架构相关）
  - 创建心理测评相关的字典类型（包括部门类型、毕业状态等）
  - _需求: 5.1, 5.2, 8.1, 9.1, 10.1_

### 阶段二：学生档案管理功能

- [ ] 4. 实现学生档案基础服务
  - 编写 StudentProfileService 接口和实现类
  - 实现学生档案的 CRUD 基础操作
  - 集成现有的部门管理体系（班级管理）
  - _需求: 4.1, 4.2, 8.2_

- [ ] 5. 实现学生档案单个创建功能
  - 编写学生档案创建的表单验证逻辑
  - 实现实时字段验证（姓名、学号、手机号等）
  - 集成现有用户体系（MemberUser关联）
  - 编写单元测试验证创建功能
  - _需求: 4.1, 5.1, 8.2_

- [ ] 6. 实现学生档案批量导入功能
  - 编写 Excel 模板下载功能
  - 实现文件上传和数据校验逻辑
  - 实现批量数据处理和错误处理机制
  - 编写导入结果反馈和报告生成
  - _需求: 4.1, 5.1, 6.1_

- [ ] 7. 实现学生档案查询和筛选功能
  - 编写多条件查询和筛选逻辑
  - 实现分页查询和排序功能
  - 集成数据权限控制（教师只能查看管理范围内学生）
  - 编写查询性能优化和索引设计
  - _需求: 4.3, 5.1, 5.2_

- [ ] 8. 实现学生360°档案页面后端支持
  - 编写综合时间线数据聚合逻辑
  - 实现测评历史、咨询记录等数据整合
  - 编写档案导出功能（PDF生成）
  - 实现操作审计日志记录
  - _需求: 4.4, 5.4, 7.1_

### 阶段三：测评量表和任务管理

- [ ] 9. 实现测评量表管理功能
  - 编写 AssessmentScaleService 服务类
  - 实现第一期固定问卷的硬编码管理（学生问卷A、学生问卷B）
  - 实现量表的基础查询功能（不支持后台编辑）
  - 编写固定问卷内容的代码化存储和解析逻辑
  - 实现量表状态管理和可用性检查
  - _需求: 2.2, 2.3_

- [ ] 10. 实现测评任务创建功能
  - 编写"创建任务 → 选择学生 → 确认信息 → 发布"四步骤流程
  - 实现任务ID/任务编号自动生成功能
  - 实现单一问卷选择逻辑（一次任务只能选择一个问卷）
  - 编写任务参与者批量生成功能
  - 实现按年级批量、按班级精确、个体搜索的学生选择
  - _需求: 2.1, 2.2, 2.3, 6.1_

- [ ] 11. 实现测评任务管理功能
  - 编写测评任务列表查询和筛选
  - 实现任务状态管理（进行中、已完成、已关闭）
  - 编写任务编辑、关闭、删除功能
  - 实现批量操作功能（批量提醒、批量关闭）
  - _需求: 2.2, 6.1, 7.1_

- [ ] 12. 实现测评任务详情和统计功能
  - 编写测评进度实时统计逻辑（"已完成"、"未完成"、"进行中"状态）
  - 实现风险等级分布统计
  - 编写年级对比、班级对比分析功能
  - 实现数据可视化图表的后端支持
  - _需求: 2.6, 7.1, 7.2, 7.3_

### 阶段四：测评参与和结果处理

- [ ] 13. 实现学生测评参与功能
  - 编写学生端测评任务获取逻辑
  - 实现多量表顺序答题流程
  - 编写答题数据保存和提交逻辑
  - 实现测评进度跟踪和断点续答
  - _需求: 1.1, 1.2, 1.3_

- [ ] 14. 实现家长独立测评功能
  - 编写家长身份验证和权限检查
  - 实现家长专用量表的业务逻辑
  - 编写家长端测评任务展示和参与流程
  - 实现家长测评结果的独立处理和分析
  - _需求: 1.1, 1.2, 5.2_

- [ ] 15. 实现测评结果计算和分析
  - 编写多量表结果综合计算逻辑
  - 实现风险等级自动判定算法
  - 编写各维度得分分析功能
  - 实现专业建议生成逻辑
  - _需求: 1.4, 3.1, 3.2, 3.3_

- [ ] 16. 实现测评报告生成功能
  - 编写个体测评报告生成逻辑（学生报告、家长报告）
  - 实现学生和家长测评结果的综合对比分析
  - 实现历史对比和趋势分析
  - 编写报告 PDF 导出功能
  - 实现报告数据的缓存优化
  - _需求: 3.1, 3.2, 3.3, 3.4_

### 阶段五：风险预警和干预管理

- [ ] 17. 实现自动风险检测功能
  - 编写测评结果风险自动识别逻辑
  - 实现高风险学生自动标记功能
  - 编写风险预警通知触发机制
  - 实现风险等级变化的历史记录
  - _需求: 1.5, 3.4, 6.3, 7.4_

- [ ] 18. 实现危机干预事件管理
  - 编写 CrisisInterventionService 服务类
  - 实现干预事件的创建、分配、处理流程
  - 编写批量转入干预的业务逻辑
  - 实现干预事件状态跟踪和统计
  - _需求: 3.4, 6.3, 7.4_

- [ ] 19. 实现学生心理状态管理
  - 编写学生心理状态更新逻辑
  - 实现状态变更的审批流程
  - 编写状态变更历史记录功能
  - 实现状态统计和分析报告
  - _需求: 4.4, 5.1, 7.1, 7.3_

### 阶段六：组织架构和权限管理

- [ ] 20. 实现组织架构管理功能
  - 编写组织架构树状结构管理逻辑（学校 → 学部 → 年级 → 班级）
  - 实现班级作为部门概念的权限设计
  - 编写班主任分配和数据权限自动分配功能
  - 实现心理老师多班级管理和权限获取
  - 编写组织架构变更时的权限自动更新机制
  - _需求: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 21. 实现登录和权限控制系统
  - 实现统一默认密码设置（如：123456）
  - 编写首次登录强制修改密码功能
  - 实现基于角色的细化数据权限过滤器（系统管理员、年级管理员、班主任、心理老师、任课老师）
  - 编写教师班级数据权限控制逻辑
  - 实现敏感操作的权限审计和日志记录
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7_

- [ ] 22. 实现学生档案时间线功能
  - 编写 StudentTimelineService 时间线服务
  - 实现综合时间线记录所有关键业务事件
  - 编写测评完成、咨询记录、状态变更等事件自动记录
  - 实现时间线记录的不可删除机制
  - 编写时间线数据的查询和展示逻辑
  - _需求: 9.1, 9.2, 9.3, 9.4, 9.5, 9.6_

- [ ] 23. 实现快速上报功能
  - 编写 QuickReportService 快速上报服务
  - 实现任课老师专用的快速上报功能入口
  - 编写学生选择、情况描述、紧急程度设置逻辑
  - 实现上报信息自动通知相关心理老师和班主任
  - 编写上报事件自动记录到学生时间线
  - 实现任课老师上报历史查看功能
  - _需求: 10.1, 10.2, 10.3, 10.4, 10.5_

- [ ] 24. 实现通知推送系统
  - 编写 NotificationService 通知服务
  - 实现多渠道通知发送（系统内、短信、微信）
  - 编写通知模板管理和个性化推送
  - 实现通知状态跟踪和重发机制
  - _需求: 6.1, 6.2, 6.3, 6.4_

- [ ] 25. 实现毕业档案管理功能
  - 编写年级统一毕业处理逻辑
  - 实现特殊心理状态学生的毕业前处理
  - 编写已毕业学生的独立档案管理
  - 实现改为就读状态的业务逻辑
  - 实现"已毕业"/"未毕业"学生筛选功能
  - _需求: 4.6, 5.10_

### 阶段七：API接口和前端集成

- [ ] 26. 实现管理端API接口
  - 编写所有管理端控制器类（/admin-api/**）
  - 实现请求参数验证和响应格式统一
  - 编写API文档和接口测试
  - 实现接口权限控制和异常处理
  - _需求: 2.1, 2.2, 2.3, 4.1, 4.2_

- [ ] 27. 实现学生家长端API接口
  - 编写学生家长端控制器类（/app-api/**）
  - 实现用户身份自动识别（学生/家长）
  - 编写移动端适配的数据格式
  - 实现接口性能优化和缓存策略
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ] 28. 实现数据导出和报表功能
  - 编写各类数据导出功能（Excel、PDF）
  - 实现大数据量导出的异步处理
  - 编写统计报表生成逻辑
  - 实现导出权限控制和审计日志
  - _需求: 4.4, 5.4, 7.1, 7.2, 7.3_

### 阶段八：系统集成和优化

- [ ] 29. 实现与现有系统的深度集成
  - 完善与用户认证系统的集成
  - 实现与现有权限管理的无缝对接
  - 编写数据同步和一致性保证机制
  - 实现系统配置和参数管理
  - _需求: 11.1, 11.2, 11.3, 11.4_

- [ ] 30. 实现系统性能优化
  - 编写数据库查询优化和索引设计
  - 实现Redis缓存策略和缓存更新机制
  - 编写大数据量处理的分页和异步逻辑
  - 实现系统监控和性能指标收集
  - _需求: 7.1, 7.2, 11.5_

- [ ] 31. 实现数据安全和加密
  - 编写敏感数据加密存储逻辑
  - 实现数据传输加密和接口安全
  - 编写操作审计和日志记录功能
  - 实现数据备份和恢复机制
  - _需求: 5.8, 5.9_

### 阶段九：测试和部署

- [ ] 32. 编写全面的单元测试
  - 为所有服务类编写单元测试
  - 实现数据访问层的集成测试
  - 编写业务逻辑的边界条件测试
  - 实现测试数据的自动化准备和清理
  - _需求: 所有需求的测试覆盖_

- [ ] 33. 编写API集成测试
  - 为所有API接口编写集成测试
  - 实现端到端的业务流程测试
  - 编写性能测试和压力测试
  - 实现自动化测试流水线配置
  - _需求: 所有需求的集成测试_

## 任务执行说明

### 开发顺序建议
1. **优先级1**：任务1-8（基础架构和学生档案）
2. **优先级2**：任务9-16（测评功能核心）
3. **优先级3**：任务17-22（风险管理和权限）
4. **优先级4**：任务23-28（接口和优化）
5. **优先级5**：任务29-30（测试和部署）

### 技术要求
- 所有代码必须遵循现有项目的编码规范
- 每个任务完成后需要编写对应的单元测试
- 数据库操作必须考虑事务一致性
- 所有外部接口调用需要添加异常处理
- 敏感数据处理需要遵循数据安全规范

### 验收标准
- 代码通过所有单元测试和集成测试
- 功能满足对应的需求验收标准
- 代码质量通过静态代码分析
- 性能指标满足系统要求
- 安全测试通过相关检查

## 里程碑计划

- **里程碑1**（任务1-8完成）：基础架构搭建完成，学生档案管理功能可用
- **里程碑2**（任务9-16完成）：测评创建和参与功能完成，核心业务流程打通
- **里程碑3**（任务17-22完成）：风险管理和权限控制完成，系统安全性达标
- **里程碑4**（任务23-28完成）：所有API接口完成，系统性能优化完成
- **里程碑5**（任务29-30完成）：测试完成，系统可以上线部署

每个里程碑完成后，都应该进行完整的功能测试和用户验收测试，确保系统的稳定性和可用性。